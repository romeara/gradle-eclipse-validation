# Eclipse Validation Preferences

Eclipse validation preferences control what validators run on project source, and are altered via the "Validation" category in the preferences menu

# org.eclipse.wst.validation.prefs

## Preference Behavior

The preferences controlling validator behavior are stored in the `org.eclipse.wst.validation.prefs` file, under the `.settings` directory in the project root. This file follows a standard properties file format of key-value pairs.

Preference handling and formatting is spread across several files - the formatting generated by this plug-in is based off the algorithms in the [Eclipse Web Tools Platform](https://github.com/eclipse/webtools.common). Of particular note are:

* [org.eclipse.wst.validation.internal.ValPrefManagerProject][ValPrefManagerProject].savePreferences(ProjectPreferences)
    * Overall handling for saving project-specific preferences to the settings file
* [org.eclipse.wst.validation.internal.ValPrefManagerGlobal][ValPrefManagerGlobal].save(Validator, PreferencesWrapper, Map<String, Validator>)
    * Handles some general validator key formatting, leads to filter group save actions
* [org.eclipse.wst.validation.internal.model.FilterGroup][FilterGroup].save(Serializer)
    * Handles the serialization of filter groups (include/exclude patterns) into a flat string for preference storage
* [org.eclipse.wst.validation.internal.model.FilterRule][FilterRule].save(Serializer)
    * Handles the serialization of filter rules for groups into a flat string for preference storage
* [org.eclipse.wst.validation.internal.ProjectConfiguration][ProjectConfiguration].store()
    * Handles top-level non-validator related preferences
    
## Preference Key/Value Specification

### Relevant Classes

* [org.eclipse.validation.internal.ConfigurationConstants][ConfigurationConstants]
* [org.eclipse.validation.internal.ValidationConfiguration][ValidationConfiguration]
* [org.eclipse.wst.validation.internal.ValPrefManagerGlobal][ValPrefManagerGlobal]
* [org.eclipse.wst.validation.internal.PrefConstants][PrefConstants]
* [org.eclipse.wst.validation.internal.model.FilterRule][FilterRule]
* [org.eclipse.wst.validation.internal.ExtensionConstants][ExtensionConstants]
* [org.eclipse.wst.validation.MessageSeveritySetting][MessageSeveritySetting]
* [org.eclipse.wst.validation.internal.model.FilterGroup][FilterGroup]

### Key/Value Layout

* **Key:** `eclipse.preferences.version`
    * **Value:** `1`
* **Key:** `USER_PREFERENCE`
    * **Defined by Constant:** [ValidationConfiguration].UserPreference
    * **Value:** `"overrideGlobalPreferences" + ["true" || "false"] + ["" || ("disableAllValidation" + ["true" || "false"] + "version" + [validationVersion])]`
    * **Value Defined By:** [ConfigurationConstants].PRJ\_OVERRIDEGLOBAL + {is project override turned on?} + {if override is on, disable validation setting and validation configuration version. Current version is defined by [ConfigurationConstants].CURRENT\_VERSION, and if behind the properties file will be migrated to the current version the first time eclipse reads it. At time of writing current was `1.2.700.v201508251749`}
* **Key:** `USER_MANUAL_PREFERENCE`
    * **Defined by Constant:** [ValidationConfiguration].UserManualPreference
    * **Value:** `"enabledManualValidatorList" + [validatorIDs]`
    * **Value Defined By:** [ConfigurationConstants].ENABLED\_MANUAL\_VALIDATORS + {ID of each validator set to manual. Each ID is followed by a ';' character}
* **Key:** `USER_BUILD_PREFERENCE`
    * **Defined by Constant:** [ValidationConfiguration].UserBuildPreference
    * **Value:** `"enabledBuildValidatorList" + [validatorIDs]`
    * **Value Defined By:** [ConfigurationConstants].ENABLED\_BUILD\_VALIDATORS + {ID of each validator set to build. Each ID is followed by a ';' character}
* **Key:** `DELEGATES_PREFERENCE`
    * **Defined by Constant:** [ValidationConfiguration].DelegatesPreference
    * **Value:** `"delegateValidatorList" + [validatorMappings]`
    * **Value Defined By:** [ConfigurationConstants].DELEGATE_VALIDATORS + {ID of each validator linked to each delegate. Format 'validatorID=delegateID;'}
* **Key:** `suspend`
    * **Defined by Constant:** [PrefConstants].suspend
    * **Value:** `["true" || "false"]`
    * **Value Defined By:** {Is validation suspended for the project?}
* **Key:** `override`
    * **Defined by Constant:** [PrefConstants].override
    * **Value:** `["true" || "false"]`
    * **Value Defined By:** {Is project override turned on?}
* **Key:** `vf.version`
    * **Defined by Constant:** [PrefConstants].frameworkVersion
    * **Value:** `["2" || "3"]`
    * **Value Defined By:** {Version of the framework being used. At time of writing, this was `3`}
    
#### Validator-Specific Key/Value Pairs

For each validator, the Eclipse framework supports 3 keys. These utilize the validator's unique ID in their specification, indicated by `[validtorID]`

* **Key:** `vals/[validatorID]/global`
    * **Defined by Constant:** [PrefConstants].global
    * **Value:** `["T" || "F"] + ["T" || "F"] + [int] + [int] + ["" || ([int] + [int] + [delegateID])]`
    * **Value Defined By:** {validator manual setting (true/false)} + {validator build setting(true/false)} + {length of validator version number - 1} + {validator version} + {length of the length of the delegate ID - 1, if delegating} + {length of delegate ID, if delegating} + {delegate ID, if delegating}
    * **Special:** Only included if changed from global settings for validation
* TODO **Key:** `vals/[validatorID]/msgs`
* TODO **Key:** `vals/[validatorID]/groups`
    
#### Example file

Example file for a project with overrides and three known validators. These validators have IDs of `validator.one` (version 1), `validator.two` (version 2), and `validator.three` (version 3)

The validators have the following settings overridden from global properties

`validator.one` is set to manual and build, with an include group which includes files in a folder `/src/stuff`
`validator.two` is set to build, which includes files in `/src/stuff`, and excludes project natures with an ID of `org.project.nature`
`validator.three` delegates to a validator with ID `delegate.validator`, and has a message severity setting with ID `message.severity` which is set to `ERROR`

The project is overriding global settings and is not suspending validation

    eclipse.preferences.version=1
    USER_PREFERENCE=overrideGlobalPreferencestruedisableAllValidationfalseversion1.2.700.v201508251749
    USER_MANUAL_PREFERENCE=enabledManualValidatorListvalidator.one;
    USER_BUILD_PREFERENCE=enabledBuildValidatorListvalidator.one;validator.two;
    DELEGATES_PREFERENCE=delegateValidatorListvalidator.three=delegate.validator;
    suspend=false
    override=true
    vf.version=3
    vals/validator.one/global=TT01
    vals/validator.two/global=FT02
    vals/validator.three/global=TT031718delegate.validator
    



[ValPrefManagerProject]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/ValPrefManagerProject.java
[ValPrefManagerGlobal]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/ValPrefManagerGlobal.java
[FilterGroup]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/model/FilterGroup.java
[FilterRule]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/model/FilterRule.java
[ProjectConfiguration]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/validate/org/eclipse/wst/validation/internal/ProjectConfiguration.java
[ConfigurationConstants]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/validate/org/eclipse/wst/validation/internal/ConfigurationConstants.java
[ValidationConfiguration]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/validate/org/eclipse/wst/validation/internal/ValidationConfiguration.java
[PrefConstants]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/PrefConstants.java
[ExtensionConstants]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/ExtensionConstants.java
[MessageSeveritySetting]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/MessageSeveritySetting.java