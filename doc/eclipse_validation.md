# Eclipse Validation Preferences

Eclipse validation preferences control what validators run on project source, and are altered via the "Validation" category in the preferences menu

# org.eclipse.wst.validation.prefs

## Builder Options

The "Add a separate validation builder" selection in a project's validation options behaves differently than most preferences. When selected, it adds a builder entry with the ID `org.eclipse.wst.validation.validationbuilder`. When de-selected, it registers the builder as an inactive external builder

## Preference Behavior

The preferences controlling validator behavior are stored in the `org.eclipse.wst.validation.prefs` file, under the `.settings` directory in the project root. This file follows a standard properties file format of key-value pairs.

Preference handling and formatting is spread across several files - the formatting generated by this plug-in is based off the algorithms in the [Eclipse Web Tools Platform](https://github.com/eclipse/webtools.common). Of particular note are:

* [org.eclipse.wst.validation.internal.ValPrefManagerProject][ValPrefManagerProject].savePreferences(ProjectPreferences)
    * Overall handling for saving project-specific preferences to the settings file
* [org.eclipse.wst.validation.internal.ValPrefManagerGlobal][ValPrefManagerGlobal].save(Validator, PreferencesWrapper, Map<String, Validator>)
    * Handles some general validator key formatting, leads to filter group save actions
* [org.eclipse.wst.validation.internal.model.FilterGroup][FilterGroup].save(Serializer)
    * Handles the serialization of filter groups (include/exclude patterns) into a flat string for preference storage
* [org.eclipse.wst.validation.internal.model.FilterRule][FilterRule].save(Serializer)
    * Handles the serialization of filter rules for groups into a flat string for preference storage
* [org.eclipse.wst.validation.internal.ProjectConfiguration][ProjectConfiguration].store()
    * Handles top-level non-validator related preferences
    
## Known Validator IDs

Validator ID is used heavily in preference storage. Some known IDs are:

TODO
    
## Preference Key/Value Specification

### Relevant Classes

* [org.eclipse.validation.internal.ConfigurationConstants][ConfigurationConstants]
* [org.eclipse.validation.internal.ValidationConfiguration][ValidationConfiguration]
* [org.eclipse.wst.validation.internal.ValPrefManagerGlobal][ValPrefManagerGlobal]
* [org.eclipse.wst.validation.internal.PrefConstants][PrefConstants]
* [org.eclipse.wst.validation.internal.model.FilterRule][FilterRule]
* [org.eclipse.wst.validation.internal.ExtensionConstants][ExtensionConstants]
* [org.eclipse.wst.validation.MessageSeveritySetting][MessageSeveritySetting]
* [org.eclipse.wst.validation.internal.model.FilterGroup][FilterGroup]
* [org.eclipse.wst.validation.internal.Serializer][Serializer]



### Key/Value Layout

* **Key:** `eclipse.preferences.version`
    * **Value:** `1`
* **Key:** `USER_PREFERENCE`
    * **Defined by Constant:** [ValidationConfiguration].UserPreference
    * **Value:** `"overrideGlobalPreferences" + ["true" || "false"] + ["" || ("disableAllValidation" + ["true" || "false"] + "version" + [validationVersion])]`
    * **Value Defined By:** [ConfigurationConstants].PRJ\_OVERRIDEGLOBAL + {is project override turned on?} + {if override is on, disable validation setting and validation configuration version. Current version is defined by [ConfigurationConstants].CURRENT\_VERSION, and if behind the properties file will be migrated to the current version the first time eclipse reads it. At time of writing current was `1.2.700.v201508251749`}
* **Key:** `USER_MANUAL_PREFERENCE`
    * **Defined by Constant:** [ValidationConfiguration].UserManualPreference
    * **Value:** `"enabledManualValidatorList" + [validatorIDs]`
    * **Value Defined By:** [ConfigurationConstants].ENABLED\_MANUAL\_VALIDATORS + {ID of each validator set to manual. Each ID is followed by a ';' character}
* **Key:** `USER_BUILD_PREFERENCE`
    * **Defined by Constant:** [ValidationConfiguration].UserBuildPreference
    * **Value:** `"enabledBuildValidatorList" + [validatorIDs]`
    * **Value Defined By:** [ConfigurationConstants].ENABLED\_BUILD\_VALIDATORS + {ID of each validator set to build. Each ID is followed by a ';' character}
* **Key:** `DELEGATES_PREFERENCE`
    * **Defined by Constant:** [ValidationConfiguration].DelegatesPreference
    * **Value:** `"delegateValidatorList" + [validatorMappings]`
    * **Value Defined By:** [ConfigurationConstants].DELEGATE_VALIDATORS + {ID of each validator linked to each delegate. Format 'validatorID=delegateID;'}
* **Key:** `suspend`
    * **Defined by Constant:** [PrefConstants].suspend
    * **Value:** `["true" || "false"]`
    * **Value Defined By:** {Is validation suspended for the project?}
* **Key:** `override`
    * **Defined by Constant:** [PrefConstants].override
    * **Value:** `["true" || "false"]`
    * **Value Defined By:** {Is project override turned on?}
* **Key:** `vf.version`
    * **Defined by Constant:** [PrefConstants].frameworkVersion
    * **Value:** `["2" || "3"]`
    * **Value Defined By:** {Version of the framework being used. At time of writing, this was `3`}
    
#### Validator-Specific Key/Value Pairs

For each validator, the Eclipse framework supports 3 keys. These utilize the validator's unique ID in their specification, indicated by `[validtorID]`

For most of the values specific to each validator, the [Serializer] plays a large role in how the preferences are saved into the properties file. Most strings are preceeded by their length minus 1, and most numeric values (including the string lengths) are also preceeded by the number of digits in them minus 1. For example, the string "example", when passed through the serializer, results in `06example` 

* **Key:** `vals/[validatorID]/global`
    * **Defined by Constant:** [PrefConstants].global
    * **Value:** `["T" || "F"] + ["T" || "F"] + [int] + [int] + ["" || ([int] + [int] + [delegateID])]`
    * **Value Defined By:** {validator manual setting (true/false)} + {validator build setting(true/false)} + {length of validator version number - 1} + {validator version} + {length of the length of the delegate ID, if delegating} + {length of delegate ID - 1, if delegating} + {delegate ID, if delegating}
    * **Special:** Only included if changed from global settings for validation
* **Key:** `vals/[validatorID]/msgs`
    * **Defined by Constant:** [PrefConstants].msgs
    * **Value:** For Each Severity: `[int] + [int] + [message setting ID] + [int] + [int]`
    * **Value Defined By:** {length of the length of the message setting ID - 1} + {length of the message setting ID} + {messaging setting ID} + {length of the severity setting - 1} + {severity setting}
    * **Severity Settings:**
        * Error = `0`
        * Warning = `1`
        * Ignore = `2`
    * **Special:** Only included if changed from global settings for validation
* **Key:** `vals/[validatorID]/groups`
    * **Defined by Constant:** [PrefConstants].groups
    * **Value:** For Each Group: `"0" + "1" + [int] + ["include" || "exclude"] + [int] + [int] + [serialized rules]`
    * **Value Defined By:** {length of serialization version - 1} + {serializtion version} + {group type being described} + {length of the number of rules - 1} + {number of rules defined} + {custom serialization for all rules - see specific serialization for each rule type}
    * **Special:** Only included if changed from global settings for validation
    
##### Serialization for Specific Filter Rules

TODO

* **Rule Type:** Content Type
    * **Defined by Constant:** [FilterRule].ContentType
    * TODO
* **Rule Type:** Facet
    * **Defined by Constant:** [FilterRule].Facet
    * TODO
* **Rule Type:** Target Runtime
    * **Defined by Constant:** [FilterRule].TargetRuntime
    * TODO
* **Rule Type:** Project Nature
    * **Defined by Constant:** [FilterRule].Project Nature
    * TODO
* **Rule Type:** File
    * **Defined by Constant:** [FilterRule].File
    * TODO
* **Rule Type:** File Extension
    * **Defined by Constant:** [FilterRule].FileExt
    * TODO
* **Rule Type:** File Pattern
    * **Defined by Constant:** [FilterRule].FilePattern
    * TODO
    
#### Example file

Example file for a project with overrides and three known validators. These validators have IDs of `validator.one` (version 1), `validator.two` (version 2), and `validator.three` (version 3)

The validators have the following settings overridden from global properties

`validator.one` is set to manual and build, with an include group which includes files in a folder `/src/stuff`
`validator.two` is set to build, which includes files in `/src/stuff`, and excludes project natures with an ID of `org.project.nature`
`validator.three` delegates to a validator with ID `delegate.validator`, and has a message severity setting with ID `message.severity` which is set to `ERROR`

The project is overriding global settings and is not suspending validation

    eclipse.preferences.version=1
    USER_PREFERENCE=overrideGlobalPreferencestruedisableAllValidationfalseversion1.2.700.v201508251749
    USER_MANUAL_PREFERENCE=enabledManualValidatorListvalidator.one;
    USER_BUILD_PREFERENCE=enabledBuildValidatorListvalidator.one;validator.two;
    DELEGATES_PREFERENCE=delegateValidatorListvalidator.three=delegate.validator;
    suspend=false
    override=true
    vf.version=3
    vals/validator.one/global=TT01
    vals/validator.two/global=FT02
    vals/validator.three/global=TT031718delegate.validator
    vals/validator.three/msgs=115message.severity00
    



[ValPrefManagerProject]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/ValPrefManagerProject.java
[ValPrefManagerGlobal]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/ValPrefManagerGlobal.java
[FilterGroup]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/model/FilterGroup.java
[FilterRule]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/model/FilterRule.java
[ProjectConfiguration]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/validate/org/eclipse/wst/validation/internal/ProjectConfiguration.java
[ConfigurationConstants]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/validate/org/eclipse/wst/validation/internal/ConfigurationConstants.java
[ValidationConfiguration]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/validate/org/eclipse/wst/validation/internal/ValidationConfiguration.java
[PrefConstants]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/PrefConstants.java
[ExtensionConstants]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/ExtensionConstants.java
[MessageSeveritySetting]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/MessageSeveritySetting.java
[Serializer]: https://github.com/eclipse/webtools.common/blob/master/plugins/org.eclipse.wst.validation/vf2/org/eclipse/wst/validation/internal/Serializer.java